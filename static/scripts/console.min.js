!function(o){"use strict";"function"==typeof define&&(define.amd||define.cmd)?define(["jquery"],o):o("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(o){"use strict";o.extend({LogOut:function(){location.href="/console/logout?rnd="+Math.random()}}),o.fn.ConsoleLogin=function(n){void 0===n&&(n={});var e,i,t,r,s,a,d=this;e=o(void 0===n.loginBoxMsg?"#loginBoxMsg":n.loginBoxMsg),i=o(void 0===n.username?"#username":n.username),t=o(void 0===n.userpwd?"#userpwd":n.userpwd),s=o(void 0===n.src_vmaddr?"#src_vmaddr":n.src_vmaddr),a=o(void 0===n.dst_vmaddr?"#dst_vmaddr":n.dst_vmaddr),r=void 0===n.standalone?!1:n.standalone,i.focus();var c=function(o){e.html(o),e.show()},l=null;if(d.bind("form-pre-serialize",function(o,n,e,i){l=t.val()}),r===!0){var u=function(n){o.post("/console/chksshdaddr?rnd="+Math.random(),{vm_addr:n.val()},function(n){var e=n;"object"!=typeof n&&(e=o.parseJSON(n)),e.ok&&a.val(e.data.en_addr)})};s.unbind("keyup").keyup(function(n){u(o(this))}),s.unbind("paste").bind("paste",function(n){u(o(this))}),s.unbind("blur").blur(function(n){u(o(this))})}d.ajaxForm({dataType:"json",beforeSubmit:function(o,n,a){if(e.hide(),r===!0){if(0===s.val().length)return s.focus(),c("请输入主机地址"),!1;var d=url.parse(s.val());if(void 0===d.host||void 0===d.port)return s.focus(),c("请输入正确的主机地址"),!1}return 0===i.val().length?(t.val(l),i.focus(),c("请输入您用户名"),!1):0===t.val().length?(t.val(l),i.focus(),c("请输入您的密码"),!1):void 0},success:function(n){var e=n;"object"!=typeof n&&(e=o.parseJSON(n)),e.ok?location.href=e.data:(t.focus(),t.select(),c(e.msg))}})},o.fn.OpenTerminal=function(n){void 0===n&&(n={});var e,i=this;e=void 0===n.wsaddr?"ws://127.0.0.1:8080/console":n.wsaddr;var t=function(n,e,i){var t=o("#c-appbar").height(),r=o(window).height(),s=(o(window).width(),r-t-10);o(".terminal").height(s),n.resize(e,i)},r=function(){function n(){var n=o("<span>",{text:"qwertyuiopasdfghjklzxcvbnm"});i.append(n);var e=n.css("line-height");e=e.substr(0,e.length-2);var t={width:n.width()/26,height:n.height()-e/2};return n.remove(),t}function e(){var n=o("#c-appbar").height(),e=o(window).height(),i=o(window).width(),t=e-n-30;return{width:i,height:t}}var t=n(),r=e();return{cols:Math.floor(r.width/t.width),rows:Math.floor(r.height/t.height)-5}};window.WebSocket=window.WebSocket||window.MozWebSocket;var s=r().cols,a=r().rows,d=null,c=new WebSocket(e+"?cols="+s+"&rows="+a);c.onopen=function(){d=new Terminal({termName:"xterm",cols:s,rows:a,useStyle:!0,convertEol:!0,screenKeys:!0,cursorBlink:!1,visualBell:!0,colors:Terminal.xtermColors}),d.open(i.get(0)),t(d,s,a),o(window).resize(function(){t(d,s,a)}),d.on("title",function(n){o(document).prop("title",n)}),d.on("data",function(o){var n=o;0!==n.length&&c.send(JSON.stringify({data:n}))}),c.onmessage=function(o){var n=o.data,e=JSON.parse(n.toString());void 0!==e.error?c.onerror(e.error):d.write(e.data)},window.term=d,window.socket=c},c.onclose=function(n){d.destroy();var e=o("<span></span>");e.text("网络中断（与服务器端连接已断开，请重新连接或联系管理员）。"),e.css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",width:"100%","text-align":"center",color:"#FFFFFF"}),e.appendTo(i)},c.onerror=function(o){console.log("Socket error:",o)}},o.fn.loading=function(n){void 0===n&&(n={});var e,i,t=this;e=void 0===n.text?"Loading...":n.text,i=void 0===n.ico_class?"mif-spinner4 mif-3x mif-ani-spin fg-green":n.ico_class;var r=o('<div><i class="'+i+'"></i> '+e+"</div>");t.html(""),t.css({position:"relative"}),t.append(r),o(r).css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",left:"45%"})}});